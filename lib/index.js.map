{"version":3,"sources":["../src/index.js"],"names":[],"mappings":"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","file":"index.js","sourcesContent":["import _ from 'lodash-firecloud';\nimport cfg from './cfg';\nimport clientCoords from './client';\nimport pageCoords from './page';\nimport screenCoords from './screen';\nimport screenToClient from './screen-to-client';\nimport windowCoords from './window';\n\nimport {\n  throttle\n} from './util';\n\nlet _passive = {\n  capture: true,\n  passive: true\n};\n\nlet _mouseEventNames = [\n  'click',\n  'dblclick',\n  'mousemove',\n  'wheel'\n];\n\nlet _touchEventNames = [\n  'touchstart'\n];\n\n// -----------------------------------------------------------------------------\n\nlet _setClient = function({\n  x, y\n}) {\n  if (_.isDefined(x)) {\n    cfg.client.x = x;\n    cfg.window.viewport.x = x;\n  }\n\n  if (_.isDefined(y)) {\n    cfg.client.y = y;\n    cfg.window.viewport.y = y;\n  }\n};\n\nlet _guestimateClientX = function() {\n  let x = windowCoords.borderSize() / 2;\n  _setClient({x});\n};\n\nlet _guestimateClientY = function() {\n  // Until the first mouse/touch event we can only guestimate.\n  // A rough estimate with/out a bookmark toolbar is ~100/75px in popular browsers\n  // with no developer tools, no status bar\n  let heightDiff =\n    windowCoords.height() -\n    clientCoords.height() -\n    windowCoords.borderSize();\n\n  // assume border only on top i.e. no status bar (guessing this is most common)\n  let y = heightDiff;\n\n  if (heightDiff > 125) {\n    // assume Developer Tools is open, and heightDiff cannot be trusted\n    // assume no bookmark toolbar (guessing this is most common)\n    y = 75;\n  }\n\n  _setClient({y});\n};\n\nlet _onMouseEvent = function(e) {\n  if (_.isDefined(window.mozInnerScreenX)) {\n    let x = window.mozInnerScreenX;\n    let y = window.mozInnerScreenY;\n    _setClient({x, y});\n    return;\n  }\n\n  if (_.isUndefined(e.clientX) ||\n    _.isUndefined(e.clientY) ||\n    _.isUndefined(e.screenX) ||\n    _.isUndefined(e.screenY)) {\n    return;\n  }\n\n  // bringing all to device pixels\n  let x = _.round(\n    e.screenX * screenCoords.osZoomFactor() -\n    windowCoords.x() -\n    e.clientX * screenCoords.osZoomFactor() * pageCoords.zoomFactor()\n  );\n\n  let y = _.round(\n    e.screenY * screenCoords.osZoomFactor() -\n    windowCoords.y() -\n    e.clientY * screenCoords.osZoomFactor() * pageCoords.zoomFactor()\n  );\n\n  _setClient({x, y});\n};\n\nlet _onTouchEvent = function(e) {\n  // not 100% correct, but we're only interested in clientXY and screenXY\n  _onMouseEvent(e.touches[0]);\n};\n\nlet _maybeGuestimateClientXY = function() {\n  // for iframes, this information needs to be guestimated via different means\n  if (window !== window.top) {\n    return;\n  }\n\n  // less accurate method, but doesn't require a mouse/touch event\n  _guestimateClientX();\n  _guestimateClientY();\n\n  // more accurate method, requires at least one mouse/touch event\n  _.forEach(_mouseEventNames, function(eventName) {\n    window.addEventListener(\n      eventName,\n      throttle(_onMouseEvent),\n      _passive\n    );\n  });\n\n  _.forEach(_touchEventNames, function(eventName) {\n    window.addEventListener(\n      eventName,\n      throttle(_onTouchEvent),\n      _passive\n    );\n  });\n};\n\nlet _maybeThrottle = function(maybeShouldThrottleFn) {\n  if (maybeShouldThrottleFn.shouldThrottle) {\n    return throttle(maybeShouldThrottleFn);\n  }\n\n  return maybeShouldThrottleFn;\n};\n\n// -----------------------------------------------------------------------------\n\nexport let init = function() {\n  _.forEach([\n    clientCoords,\n    pageCoords,\n    screenCoords,\n    windowCoords\n  ], function(obj) {\n    _.merge(obj, _.mapValuesDeep(_maybeThrottle)(obj));\n  });\n\n  _maybeGuestimateClientXY();\n};\n\nexport {\n  cfg,\n  screenCoords as screen,\n  windowCoords as window,\n  clientCoords as client,\n  pageCoords as page,\n  screenToClient\n};\n\nexport default exports;\n"]}