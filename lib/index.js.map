{"version":3,"sources":["../src/index.js"],"names":[],"mappings":"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","file":"index.js","sourcesContent":["import _ from 'lodash-firecloud';\nimport cfg from './cfg';\nimport clientCoords from './client';\nimport pageCoords from './page';\nimport screenCoords from './screen';\nimport windowCoords from './window';\n\nimport {\n  throttle\n} from './util';\n\nlet _passive = {\n  capture: true,\n  passive: true\n};\n\nlet _mouseEventNames = [\n  'click',\n  'dblclick',\n  'mousemove',\n  'wheel'\n];\n\nlet _touchEventNames = [\n  'touchstart'\n];\n\n// -----------------------------------------------------------------------------\n\nlet _setClient = function({\n  x, y\n}) {\n  if (!_.isUndefined(x)) {\n    cfg.client.x = x;\n    cfg.window.viewport.x = x;\n  }\n\n  if (!_.isUndefined(y)) {\n    cfg.client.y = y;\n    cfg.window.viewport.y = y;\n  }\n};\n\nlet _guestimateH = function() {\n  let x = windowCoords.borderSize() / 2;\n  _setClient({x});\n};\n\nlet _guestimateV = function() {\n  // Until the first mouse/touch event we can only guestimate.\n  // A rough estimate with/out a bookmark toolbar is ~100/75px in popular browsers\n  // with no developer tools, no status bar\n  let heightDiff =\n    windowCoords.height() -\n    clientCoords.height() -\n    windowCoords.borderSize();\n\n  // assume border only on top i.e. no status bar (guessing this is most common)\n  let y = heightDiff;\n\n  if (heightDiff > 125) {\n    // assume Developer Tools is open, and heightDiff cannot be trusted\n    // assume no bookmark toolbar (guessing this is most common)\n    y = 75;\n  }\n\n  _setClient({\n    y\n  });\n};\n\nlet _onMouseEvent = function(e) {\n  if (!_.isUndefined(window.mozInnerScreenX)) {\n    let x = window.mozInnerScreenX;\n    let y = window.mozInnerScreenY;\n    _setClient({x, y});\n    return;\n  }\n\n  if (_.isUndefined(e.clientX) ||\n    _.isUndefined(e.clientY) ||\n    _.isUndefined(e.screenX) ||\n    _.isUndefined(e.screenY)) {\n    return;\n  }\n\n  // bringing all to device pixels\n  let x = _.round(\n    e.screenX * screenCoords.osZoomFactor() -\n    windowCoords.x() -\n    e.clientX * screenCoords.osZoomFactor() * pageCoords.zoomFactor()\n  );\n\n  let y = _.round(\n    e.screenY * screenCoords.osZoomFactor() -\n    windowCoords.y() -\n    e.clientY * screenCoords.osZoomFactor() * pageCoords.zoomFactor()\n  );\n\n  _setClient({x, y});\n};\n\nlet _onTouchEvent = function(e) {\n  // not 100% correct, but we're only interested in clientXY and screenXY\n  _onMouseEvent(e.touches[0]);\n};\n\n// -----------------------------------------------------------------------------\n\nexport let init = function() {\n  if (window !== window.top) {\n    return;\n  }\n\n  _.forEach(_mouseEventNames, function(eventName) {\n    window.addEventListener(\n      eventName,\n      throttle(_onMouseEvent),\n      _passive\n    );\n  });\n\n  _.forEach(_touchEventNames, function(eventName) {\n    window.addEventListener(\n      eventName,\n      throttle(_onTouchEvent),\n      _passive\n    );\n  });\n\n  _guestimateH();\n  _guestimateV();\n};\n\nexport {\n  cfg,\n  clientCoords as client,\n  pageCoords as page,\n  screenCoords as screen,\n  windowCoords as window\n};\n\nexport default exports;\n"]}