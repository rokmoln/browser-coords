{"version":3,"sources":["../src/index.js"],"names":[],"mappings":"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","file":"index.js","sourcesContent":["import _ from 'lodash';\nimport cfg from './cfg';\nimport clientCoords from './client';\nimport pageCoords from './page';\nimport screenCoords from './screen';\nimport windowCoords from './window';\n\nimport {\n  throttleDeeply\n} from './util';\n\nexport let _passive = {\n  capture: true,\n  passive: true\n};\n\nexport let _mouseEventNames = [\n  'click',\n  'dblclick',\n  'mousemove',\n  'wheel'\n];\n\nexport let _touchEventNames = [\n  'touchstart'\n];\n\n// -----------------------------------------------------------------------------\n\nexport let _setClient = function({\n  x, y\n}) {\n  if (!_.isUndefined(x)) {\n    cfg.client.x = x;\n    cfg.window.viewport.x = x;\n  }\n\n  if (!_.isUndefined(y)) {\n    cfg.client.y = y;\n    cfg.window.viewport.y = y;\n  }\n};\n\nexport let _guestimateH = function() {\n  let x = windowCoords.borderSize() / 2;\n  exports._setClient({x});\n};\n\nexport let _guestimateV = function() {\n  // Until the first mouse/touch event we can only guestimate.\n  // A rough estimate with/out a bookmark toolbar is ~100/75px in popular browsers\n  // with no developer tools, no status bar\n  let heightDiff =\n    windowCoords.height() -\n    clientCoords.height() -\n    windowCoords.borderSize();\n\n  // assume border only on top i.e. no status bar (guessing this is most common)\n  let y = heightDiff;\n\n  if (heightDiff > 125) {\n    // assume Developer Tools is open, and heightDiff cannot be trusted\n    // assume no bookmark toolbar (guessing this is most common)\n    y = 75;\n  }\n\n  exports._setClient({\n    y\n  });\n};\n\nexport let _onMouseEvent = function(e) {\n  if (!_.isUndefined(window.mozInnerScreenX)) {\n    let x = window.mozInnerScreenX;\n    let y = window.mozInnerScreenY;\n    exports._setClient({x, y});\n    return;\n  }\n\n  if (_.isUndefined(e.clientX) ||\n    _.isUndefined(e.clientY) ||\n    _.isUndefined(e.screenX) ||\n    _.isUndefined(e.screenY)) {\n    return;\n  }\n\n  // bringing all to device pixels\n  let x = _.round(\n    e.screenX * screenCoords.osZoomFactor() -\n    windowCoords.x() -\n    e.clientX * screenCoords.osZoomFactor() * pageCoords.zoomFactor()\n  );\n\n  let y = _.round(\n    e.screenY * screenCoords.osZoomFactor() -\n    windowCoords.y() -\n    e.clientY * screenCoords.osZoomFactor() * pageCoords.zoomFactor()\n  );\n\n  exports._setClient({x, y});\n};\n\nexport let _onTouchEvent = function(e) {\n  // not 100% correct, but we're only interested in clientXY and screenXY\n  exports._onMouseEvent(e.touches[0]);\n};\n\n// -----------------------------------------------------------------------------\n\nexport let init = function() {\n  if (window !== window.top) {\n    return;\n  }\n\n  _.forEach(exports._mouseEventNames, function(eventName) {\n    window.addEventListener(\n      eventName,\n      _.throttle(exports._onMouseEvent, 1000),\n      exports._passive\n    );\n  });\n\n  _.forEach(exports._touchEventNames, function(eventName) {\n    window.addEventListener(\n      eventName,\n      _.throttle(exports._onTouchEvent, 1000),\n      exports._passive\n    );\n  });\n\n  exports._guestimateH();\n  exports._guestimateV();\n};\n\nexport let throttle = function(wait) {\n  let throttled = _.omit(_.cloneDeep(exports), [\n    'throttle'\n  ]);\n\n  throttled = throttleDeeply(throttled, wait);\n  return throttled;\n};\n\nexport let toJSON = function() {\n  return {\n    page: pageCoords.toJSON(),\n    client: clientCoords.toJSON(),\n    window: windowCoords.toJSON(),\n    screen: screenCoords.toJSON()\n  };\n};\n\nexport {\n  cfg,\n\n  pageCoords as page,\n  clientCoords as client,\n  windowCoords as window,\n  screenCoords as screen\n};\n\nexport default exports;\n"]}