{"version":3,"sources":["../src/screen.ts"],"names":[],"mappings":"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","file":"screen.js","sourcesContent":["import _ from 'lodash-firecloud';\nimport cfg from './cfg';\n\nimport {\n  roundRect,\n  shouldThrottle\n} from './util';\n\ndeclare global {\n  interface Screen {\n    availLeft?: number;\n    availTop?: number;\n  }\n}\n\n// NOTE function taken out of the 'screen' variable assignment to assist typescript into inferring types\nexport let getOsZoomFactor = function(): number {\n  if (_.isDefined(cfg.screen.osZoomFactor)) {\n    return cfg.screen.osZoomFactor;\n  }\n\n  if (_.includes(navigator.appVersion, 'Win')) {\n    // it's the same thing as DPI zoom (usually between 100-200%%)\n\n    // not using pageCoords.zoomFactor() to avoid circular dependency\n    let pageZoomFactor = _.defaultTo(cfg.page.zoomFactor, 1);\n    let pixelRatio = window.devicePixelRatio / pageZoomFactor;\n    return _.round(pixelRatio, 2);\n  }\n\n  return 1;\n};\n\n// eslint-disable-next-line @typescript-eslint/explicit-function-return-type\nexport let toJSON = function() {\n  return roundRect({\n    cfg: screen.cfg,\n\n    width: screen.width(),\n    height: screen.height(),\n\n    available: roundRect({\n      left: screen.available.left(),\n      top: screen.available.top(),\n      width: screen.available.width(),\n      height: screen.available.height()\n    }),\n\n    orientation: {\n      angle: screen.orientation.angle(),\n      type: screen.orientation.type()\n    },\n\n    osZoomFactorPercentile: _.round(screen.osZoomFactor() * 100),\n    pixelRatioPercentile: _.round(screen.pixelRatio() * 100)\n  });\n};\n\n// current screen\n// coordinates in device px\nexport let screen = {\n  cfg: cfg.screen,\n\n  width: shouldThrottle(function() {\n    return window.screen.width * getOsZoomFactor();\n  }),\n\n  height: shouldThrottle(function() {\n    return window.screen.height * getOsZoomFactor();\n  }),\n\n  available: {\n    left: shouldThrottle(function() {\n      return window.screen.availLeft * getOsZoomFactor();\n    }),\n\n    top: shouldThrottle(function() {\n      return window.screen.availTop * getOsZoomFactor();\n    }),\n\n    width: shouldThrottle(function() {\n      return window.screen.availWidth * getOsZoomFactor();\n    }),\n\n    height: shouldThrottle(function() {\n      return window.screen.availHeight * getOsZoomFactor();\n    })\n  },\n\n  orientation: {\n    angle: shouldThrottle(function() {\n      return _.get(window.screen, 'orientation.angle') as Window['screen']['orientation']['angle'];\n    }),\n\n    type: shouldThrottle(function() {\n      return _.get(window.screen, 'orientation.type') as Window['screen']['orientation']['type'];\n    })\n  },\n\n  osZoomFactor: shouldThrottle(function() {\n    return getOsZoomFactor();\n  }),\n\n  pixelRatio: shouldThrottle(function() {\n    if (_.isDefined(cfg.screen.pixelRatio)) {\n      return cfg.screen.pixelRatio;\n    }\n\n    // not using pageCoords.zoomFactor() to avoid circular dependency\n    let pageZoomFactor = _.defaultTo(cfg.page.zoomFactor, 1);\n    let pixelRatio = window.devicePixelRatio / pageZoomFactor;\n    return _.round(pixelRatio, 2);\n  }),\n\n  toJSON\n};\n\nexport default screen;\n"]}